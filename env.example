# ==============================================================================
# FB Nova Data Sync - Environment Variables
# ALIGNED WITH SOLUTION ARCHITECTURE DESIGN DOCUMENT (SADD)
# ==============================================================================
# Copy this file to .env and fill in your values
# NEVER commit .env to source control!
# ==============================================================================

# ------------------------------------------------------------------------------
# Azure Storage Configuration
# ------------------------------------------------------------------------------
# Connection string for Azure Blob Storage (used for CSV staging)
STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=stsynfbnovadev;AccountKey=YOUR_KEY_HERE;EndpointSuffix=core.windows.net

# Storage Account Key (used in COPY INTO command for authentication)
STORAGE_KEY=YOUR_STORAGE_ACCOUNT_KEY

# Storage Account Name (default: stsynfbnovadev)
STORAGE_ACCOUNT=stsynfbnovadev

# Blob Container Name (default: synapsedata)
CONTAINER_NAME=synapsedata

# ------------------------------------------------------------------------------
# Service Principal Authentication (for automated/scheduled runs)
# ------------------------------------------------------------------------------
# Create a Service Principal with access to both Synapse databases:
#   az ad sp create-for-rbac --name "fb-nova-sync-sp"
#
# Grant the SP access to Synapse:
#   - Source: Reader role on FB_DW
#   - Target: Contributor role on sqlpoolfbnovadev

AZURE_CLIENT_ID=your-service-principal-client-id
AZURE_CLIENT_SECRET=your-service-principal-secret
AZURE_TENANT_ID=your-azure-tenant-id

# ------------------------------------------------------------------------------
# Interactive Authentication (for local testing only)
# ------------------------------------------------------------------------------
# Your Azure AD email address (will open browser for authentication)
USERNAME=your.email@famousbrands.co.za

# ------------------------------------------------------------------------------
# Source Database Configuration (Production)
# ------------------------------------------------------------------------------
SOURCE_SERVER=az-zan-sws-prod-01.sql.azuresynapse.net
SOURCE_DATABASE=FB_DW

# ------------------------------------------------------------------------------
# Target Database Configuration (Development)
# ------------------------------------------------------------------------------
TARGET_SERVER=synapse-fbnova-dev.sql.azuresynapse.net
TARGET_DATABASE=sqlpoolfbnovadev

# ==============================================================================
# SADD-ALIGNED CONFIGURATION
# ==============================================================================
# These settings align with the Solution Architecture Design Document (SADD)

# ------------------------------------------------------------------------------
# Source System Identification (per SADD)
# ------------------------------------------------------------------------------
# Unique ID for each source system (per SADD: Source_system_Id)
# 1 = FB_DW_PROD, 2 = POS, 3 = CRM, 4 = FIS, 5 = MUNCH
SOURCE_SYSTEM_ID=1
SOURCE_SYSTEM_NAME=FB_DW_PROD

# ------------------------------------------------------------------------------
# Pipeline Configuration (per SADD)
# ------------------------------------------------------------------------------
# Pipeline naming convention per SADD: PL_POS, PL_FIS, PL_NOVA_SYNC
PIPELINE_NAME=PL_NOVA_SYNC

# Trigger type per SADD: manual, scheduled, event-based
TRIGGER_TYPE=manual

# ------------------------------------------------------------------------------
# Processing Settings
# ------------------------------------------------------------------------------
# Chunk size for CSV exports (default: 500000 rows)
CHUNK_SIZE=500000

# Delta lookback period in days (default: 7)
DELTA_LOOKBACK_DAYS=7

# ------------------------------------------------------------------------------
# Data Quality Configuration (per SADD)
# ------------------------------------------------------------------------------
# Enable/disable data quality checks (per SADD: Source vs FDW Validation)
ENABLE_DATA_QUALITY_CHECKS=true

# Tolerance percentage for row count validation (default: 1%)
ROW_COUNT_TOLERANCE_PERCENT=0.01

# ------------------------------------------------------------------------------
# Alerting Configuration (per SADD: Operations | Alerting)
# ------------------------------------------------------------------------------
# Microsoft Teams or Slack webhook URL for failure alerts
# Leave empty to disable alerting
ALERT_WEBHOOK_URL=

# Enable email alerts (requires additional setup)
ALERT_EMAIL_ENABLED=false

# ==============================================================================
# CONFIGURATION EXAMPLES
# ==============================================================================

# Example 1: Automated scheduled run (production)
# -----------------------------------------------
# AZURE_CLIENT_ID=12345678-1234-1234-1234-123456789012
# AZURE_CLIENT_SECRET=your-secret-here
# AZURE_TENANT_ID=your-tenant-id
# TRIGGER_TYPE=scheduled
# PIPELINE_NAME=PL_NOVA_SYNC_PROD
# ENABLE_DATA_QUALITY_CHECKS=true
# ALERT_WEBHOOK_URL=https://outlook.office.com/webhook/...

# Example 2: Manual local development run
# ---------------------------------------
# USERNAME=developer@famousbrands.co.za
# TRIGGER_TYPE=manual
# PIPELINE_NAME=PL_NOVA_SYNC_DEV
# ENABLE_DATA_QUALITY_CHECKS=false
# ALERT_WEBHOOK_URL=

# Example 3: Delta-only sync with longer lookback
# -----------------------------------------------
# DELTA_LOOKBACK_DAYS=30
# ENABLE_DATA_QUALITY_CHECKS=true

# ==============================================================================
# NOTES
# ==============================================================================
# 
# Authentication Priority:
#   1. If AZURE_CLIENT_ID + AZURE_CLIENT_SECRET are set → Service Principal auth
#   2. If USERNAME is set → Interactive auth (browser popup)
#   3. If neither → Error
#
# For automated deployments (ACI, Azure Automation, etc.):
#   - Use Service Principal authentication
#   - Set TRIGGER_TYPE=scheduled
#   - Configure ALERT_WEBHOOK_URL for failure notifications
#
# For local development/testing:
#   - Either auth method works
#   - Interactive is easier for quick tests
#   - Set TRIGGER_TYPE=manual
#
# SADD Alignment:
#   - SOURCE_SYSTEM_ID maps to SADD Source_system_Id requirement
#   - PIPELINE_NAME follows SADD naming convention (PL_*)
#   - TRIGGER_TYPE follows SADD trigger types
#   - Data Quality checks implement SADD Source vs FDW Validation
#   - Alerting implements SADD Operations | Alerting requirements
#
# ==============================================================================
